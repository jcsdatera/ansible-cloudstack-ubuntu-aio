---
- name: Change root permission for ssh connection
  lineinfile: dest=/etc/ssh/sshd_config regexp="^PermitRootLogin .*$" line="PermitRootLogin yes"
  when: host_enable_ssh_direct_root

- name: Crypt root password with mkpasswd
  shell: echo -n {{ host_root_password }} | mkpasswd --stdin --method=SHA-512
  register: passwd_crypt
  when: host_enable_ssh_direct_root

- debug: var=passwd_crypt.stdout
  when: host_enable_ssh_direct_root
  
- name: Change (or create) password for root
  user: name=root password="{{ passwd_crypt.stdout }}"
  when: host_enable_ssh_direct_root
    
- name: "Create missing ed25519 key (not generated by ubuntu)"
  shell: "ssh-keygen -A"
  when: host_enable_ssh_direct_root

- name: "Restart sshd. (use command module instead of service module as a workaround of a bug in Ansible < 2.0)"
  # command: service ssh restart
  service: name=ssh state=restarted
  when: host_enable_ssh_direct_root

